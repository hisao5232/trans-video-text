services:
  worker:
    build: ./worker
    volumes:
      - ./temp:/app/temp
    depends_on:
      - voicevox
      - rewriter
    environment:
      - VOICEVOX_HOST=voicevox
      - REWRITER_HOST=rewriter
    tty: true

  rewriter: # ★新規サービス
    build: ./rewriter
    environment:
      GEMINI_API_KEY: ${GEMINI_API_KEY} 
    ports:
      - "5000:5000" # 外部からのアクセスを許可したい場合（必須ではないがデバッグ用に残す）
    restart: always

  voicevox:
    image: voicevox/voicevox_engine:cpu-latest
    ports:
      - "50021:50021"
    restart: always
    
  storage:
    build: ./storage
    container_name: storage
    volumes:
      - ./temp:/app/temp
      - ./storage/token.json:/app/token.json
      - ./storage/credentials.json:/app/credentials.json
    environment:
      # GoogleドライブのフォルダID（ブラウザのURL末尾にある文字列）を貼ると、そのフォルダに保存されます
      - DRIVE_FOLDER_ID=${DRIVE_FOLDER_ID}
      - MY_EMAIL=${MY_EMAIL}
    restart: always
